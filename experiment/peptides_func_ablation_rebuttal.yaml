seml:
  executable: experiment_fragmentation.py
  name: peptides_func_ablation_testing
  output_dir: /ceph/hdd/students/kempern/experiment/logs/peptides_func_ablation
  project_root_dir: ~/substructure-gnns
#  description: A first test.

slurm:
  experiments_per_job: 2
  max_simultaneous_jobs: 8  # Restrict number of simultaneously running jobs per job array
  sbatch_options:
    gres: gpu:1       # num GPUs
    #mem: 16G          # memory
    mem: 64G          # memory
    #cpus-per-task: 4  # num cores
    cpus-per-task: 9  # num cores
    #time: 0-00:55     # max time, D-HH:MM
    time: 1-00:00
    partition: gpu_all
    #exclude: gpu04,gpu12,gpu13,gpu08,gpu10,mdsi-gpu01,mdsi-gpu02

###### BEGIN PARAMETER CONFIGURATION ######

fixed:
  project_name: "peptides func ablation_testing"
  trainer_params:
    max_epochs: 400
    testing: False
    min_lr: 1e-6
    monitor: "val_average_multilabel_precision"

  data:
    dataset_params.dataset_seed: 0
    loader_params:
      batch_size: 128
      num_workers: 4
      val_batch_size: 3000
    dataset: "peptides-func"
    one_hot_edge_features: False
    one_hot_node_features: False
    fragmentation_method: ["RingsPaths", "higher_level_graph_tree", {"vocab_size": 30, "max_ring": 15}]
    
  model:
    model_type: "HimpNetSmall"
    classification: True
    model_params:
      #dropout: 0.15
      out_channels: 10
      #num_layers: 3
      inter_message_passing: True
      higher_message_passing: True
      encoding_size_scaling: True
      degree_scaling: False
      learned_edge_rep: True
      inter_message_params.reduction: "mean"
      atom_feature_params:
        num_atom_types: 20
        num_atom_features: 9
      edge_feature_params:
        num_bond_types: 4
        num_bond_features: 3
    

  optimization:
    optimization_params:
      lr: 0.001
      weight_decay: 0
    additional_metric: "ap"
    scheduler_parameters:
      mode: "min"
      factor: 0.5
      patience: 30
  
  trainer_params.testing: True

grid:
  model.model_params.hidden_channels:
    type: choice
    options:
      - 128

  trainer_params:
    gradient_clip_val:
      type: choice
      options:
        - 1
    
  
  optimization.ema_decay:
    type: choice
    options:
      - 0.99
      #- 0.999
      #- None

  model.model_params.num_layers_out:
    type: choice
    options:
      #- 2
      - 3

  model.model_params.frag_reduction:
    type: choice
    options:
      - "sum"
      #- "max"
  
  model.model_params.reduction:
    type: choice
    options:
      - "mean"
      #- "sum"

  model.model_params.num_layers:
    type: choice
    options:
      - 2
      #- 3
      #- 4

  model.model_params.dropout:
    type: choice
    options:
      - 0.15

  data.seed:
    type: choice
    options:
      - 23
      #- 24
      #- 25

# Everything:
#   fixed:
#     notes: "Everything"


# NoOrdinalEncoding:
#   fixed:
#     notes: "NoOrdinalEncoding"
#     model.model_params.encoding_size_scaling: False

# FragRep:
#   fixed:
#     notes: "FragRep"
#     model.model_params.higher_message_passing: False


# NodeFeatures:
#   fixed:
#     notes: "NodeFeatures"
#     model.model_params.higher_message_passing: False
#     model.model_params.inter_message_passing: False

# NoFragInfo:
#   fixed:
#     notes: "NoFragInfo"
#     model.model_params.higher_message_passing: False
#     model.model_params.inter_message_passing: False
#     model.model_params.no_frag_info: True

FragmentationMethods:
  fixed:
    notes: "FragmentationMethods"
    project_name: "peptides func ablation frag method"
  grid:
    data.fragmentation_method:
      type: choice
      options:
        - ["RingsPaths", "higher_level_graph_tree", {"vocab_size": 30, "max_ring": 15}]
        - ["BBB", "higher_level_graph_tree", {"vocab_size": 100}]
        #- ["Magnet", "higher_level_graph_tree", {"vocab_size": 100}]
        - ["BRICS", "higher_level_graph_tree", {"vocab_size": 100}]
        - ["PSM", "higher_level_graph_tree", {"vocab_size": 100}]
        - ["Rings", "higher_level_graph_tree", {"vocab_size": 15}]
      zip_id: frag_method
  
    model.model_params.encoding_size_scaling:
      type: choice
      options:
        - True
        - False
        #- False
        - False
        - False
        - True
      zip_id: frag_method



  





  

  
