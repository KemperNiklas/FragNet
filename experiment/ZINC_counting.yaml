seml:
  executable: experiment_fragmentation.py
  name: ZINC_counting
  output_dir: /ceph/hdd/students/kempern/experiment/logs/ZINC_counting
  project_root_dir: ~/substructure-gnns
#  description: A first test.

slurm:
  experiments_per_job: 4
  max_simultaneous_jobs: 8  # Restrict number of simultaneously running jobs per job array
  sbatch_options:
    gres: gpu:1       # num GPUs
    mem: 16G          # memory
    #mem: 64G          # memory
    #cpus-per-task: 4  # num cores
    cpus-per-task: 3  # num cores
    #time: 0-00:55     # max time, D-HH:MM
    time: 0-05:00
    partition: gpu_all
    qos: deadline
    #exclude: gpu04,gpu12,gpu13,gpu08,gpu10,mdsi-gpu01,mdsi-gpu02

###### BEGIN PARAMETER CONFIGURATION ######

fixed:
  project_name: "ZINC_counting"
  notes: "with more metrics"
  trainer_params:
    max_epochs: 200
    testing: False
    min_lr: 1e-8

  data:
    #seed: 40
    dataset_params.dataset_seed: 0
    loader_params:
      batch_size: 128
      num_workers: 4
      val_batch_size: 2000
    dataset: "ZINC-count"
    one_hot_edge_features: False
    one_hot_node_features: False
    fragmentation_method: ["RingsPaths", "higher_level_graph_tree", {"vocab_size": 30, "max_ring": 15}]
    
  model:
    model_type: "HimpNetSmall"
    classification: False
    model_params:
      #hidden_channels: 128
      dropout: 0
      num_layers: 3
      inter_message_passing: True
      higher_message_passing: True
      encoding_size_scaling: True
      degree_scaling: False
      learned_edge_rep: True
      inter_message_params.reduction: "mean"
      reduction: "sum"
      atom_feature_params:
        num_atom_types: 30
        num_atom_features: 1
      edge_feature_params:
        num_bond_types: 4
        num_bond_features: 1
      #rbf: 20
      #concat: False


  optimization:
    # optimization_params:
    #   lr: 0.001
      #weight_decay: 5e-4
    loss: "mae"
    scheduler_parameters:
      mode: "min"
      factor: 0.5
      patience: 20
    additional_metric: "counting_experiment"

grid:
  model.model_params.hidden_channels:
    type: choice
    options:
      - 120

  trainer_params:
    gradient_clip_val:
      type: choice
      options:
        - 1

  optimization.optimization_params.lr:
    type: choice
    options:
      - 0.001
      #- 0.0001
      #- 0.01
  
  optimization.ema_decay:
    type: choice
    options:
      #- 0.99
      #- 0.999
      - None

  
  model.model_params.frag_reduction:
    type: choice
    options:
      - "sum"
      #- "mean"
 
  data.seed:
    type: choice
    options:
      - 23
      #- 24
      #- 25
  
  # data.dataset_params.substructure_idx:
  #   type: choice
  #   options:
  #    # - None
  #    - 0
  #    - 1
  #    - 2
  #    - 3
  #     # - 28
  #     # - 29
  #     # - 30
  #     # - 31
  #     # - 32
  #     # - 33
  #     # - 34
  #     # - 35
  #     # - 36
  #     # - 37
  #     # - 38
  #     # - 39
  #     # - 40
  #     # - 41

  data.dataset_params.substructure_idx:
    type: range
    min: 0
    max: 42
    step: 1



  





  

  
